---
description: Project context for the Elastic Workflows & Agents Instruqt workshop
alwaysApply: true
---

# Elastic Workflows & Agents Workshop

This is an Instruqt hands-on workshop: **"From Findings to Outcomes: Automating with Elastic Workflows & Agents"**

- **Track slug**: `workflows-agents-alerts`
- **Track ID**: `tvu7yvg32vsk`
- **Owner**: Jeff Vestal (jeff.vestal@elastic.co)

## Directory Layout

```
dr-rangelove-stove-store/          # Project root (dev codename)
├── instruqt/                      # PRODUCTION track (pushed to Instruqt)
│   ├── track.yml                  # Track metadata + checksum
│   ├── config.yml                 # VM/infra/secrets config
│   ├── track_scripts/             # Per-VM setup scripts
│   ├── assets/                    # Shared images (screenshots)
│   └── 01-01-intro/ .. 09-09-*/   # Challenge dirs
│       ├── assignment.md          # Challenge content (YAML frontmatter + markdown)
│       └── assets/solution.yml    # Solution YAML
├── dr-rangelove-stove-store/      # DEVELOPMENT copy (may drift from production)
├── workshop-assets/               # Runtime assets deployed to VMs
│   ├── data_generator/            # Python data sprayer + scenarios.json
│   └── setup_scripts/             # Numbered bash scripts (01-06)
├── ELASTIC_WORKFLOWS_REFERENCE.md # Workflow YAML syntax reference
└── INSTRUQT_REFERENCE.md          # Instruqt track structure reference
```

**The `instruqt/` directory is the production version.** Always edit there unless specifically asked about the dev copy.

## The 9 Challenges

| # | Slug | Topic |
|---|------|-------|
| 1 | `01-intro` | Workshop intro |
| 2 | `02-hello-world` | First workflow (console + inputs) |
| 3 | `03-chaining-steps` | Multi-step workflows |
| 4 | `04-robust-workflows` | Error handling, retries, conditionals |
| 5 | `05-ai-orchestration` | AI Agent chaining (generator-critic-remediator) |
| 6 | `06-observability-bot` | Elasticsearch queries + triage report |
| 7 | `07-self-healing-ai` | Alert-triggered auto-remediation |
| 8 | `08-business-impact-detection` | ES\|QL + business SLO analysis |
| 9 | `09-workflows-summary` | Wrap-up |

## Key Technical Details

### Elastic Workflows YAML
- `version: "1"`, defined in YAML, runs in Kibana (Management > Workflows)
- Step types: `console`, `elasticsearch.search`, `elasticsearch.esql.query`, `elasticsearch.request`, `http`, `ai.agent`, `if`
- Use `elasticsearch.request` with `method: PUT` instead of `elasticsearch.index` (known bug)
- Liquid templating: `{{ }}` for string interpolation, `${{ }}` for type-preserving evaluation in conditions

### AI Agent Steps (`ai.agent`)
- Output is at `steps.<name>.output` (plain text)
- Do NOT use `steps.<name>.output.response.message` -- that path is for `kibana.post_agent_builder_converse` (deprecated dev-only step type)
- For JSON responses, parse with `{{ steps.<name>.output | json_parse }}`

### Elasticsearch Data
- Index: `o11y-heartbeat` (generated by `workshop-assets/data_generator/data_sprayer.py`)
- Fields use **flat dotted keys** in `_source`, e.g. `"log.message"`, `"service.name"`, `"http.status_code"`
- In Liquid templates, dotted field names require bracket notation: `._source["log.message"]` not `._source.log.message`
- The `| default: "fallback"` filter should be used for fields that may be missing

### Aggregation Output Paths
- `elasticsearch.search` aggregations: `steps.<name>.output.aggregations.<agg>.<field>`
  - Note: sometimes under `.output.response.aggregations` -- check actual output
- `elasticsearch.esql.query`: `steps.<name>.output.values[row][col]`

## Publishing Workflow

### Git + Instruqt CLI
```bash
# Push local changes to Instruqt
cd instruqt/ && instruqt track push

# Pull changes made in Instruqt UI back to local
cd instruqt/ && instruqt track pull
```

- The `track.yml` checksum field is auto-managed by the Instruqt CLI; don't manually edit it.
- Screenshots are sometimes added via the Instruqt web UI (easiest for image hosting), then pulled back with `instruqt track pull`.
- After pulling, always `git diff` to verify only expected changes came through before committing.
- Push to both GitHub (`git push`) and Instruqt (`instruqt track push`) to keep them in sync.

## Past Bug Fixes (Known Gotchas)

1. **Challenge 5 blank drafts**: Was using `.output.response.message` for `ai.agent` steps. Fixed to `.output`.
2. **Challenge 6 blank "Sample Error"**: `log.message` is a flat dotted key, not nested. Liquid dot notation fails silently. Fixed with bracket notation `._source["log.message"]`.
3. **Alert field access**: `kibana.alert.*` fields also use dotted keys. Access with bracket notation: `event.alerts[0]['kibana.alert.rule.name']`.
